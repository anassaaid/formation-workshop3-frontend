<html>
	<head>
		<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.css">
		<script src="https://code.jquery.com/jquery-2.x-git.min.js"></script>
  		<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.js"></script>
  		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script type="text/javascript" src="http://malsup.github.io/min/jquery.form.min.js"></script>
		<script src="http://ksylvest.github.io/jquery-growl/javascripts/jquery.growl.js" type="text/javascript"></script>
		<link href="http://ksylvest.github.io/jquery-growl/stylesheets/jquery.growl.css" rel="stylesheet" type="text/css" />
	</head>

	<body>
		<button class="btn btn-success btn-create" data-toggle="modal" data-target="#myModal">Create new blog</button>
		<table id="blog-list">
			<thead>
				<tr>
					<td>ID</td>
					<td>Titre</td>
					<td>Description</td>
					<td>Category</td>
					<td>Date</td>
					<td>Actions</td>
				</tr>
			</thead>
		</table>

		<!-- Modal -->
		<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModal">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		     <form class="blog-form" method="post" novalidate>
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title" id="detailModal">detail blog</h4>
			      </div>
			      <div class="modal-body">
			      </div>
		      </form>
	      </div>
	      </div>
      </div>

		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		     <form class="blog-form" method="post" novalidate>
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h4 class="modal-title" id="myModalLabel">create new blog</h4>
			      </div>
			      <div class="modal-body">
			        <div id="blog">
				        <div class="form-group">
					        <label for="blog_titre" class="control-label required">Titre</label>
					        <input type="text" value="" class="form-control" required="required" name="blog[titre]" id="blog_titre">
				        </div>

				        <div class="form-group">
					        <label for="blog_category" class="control-label required">Category</label>
					        <select class="form-control" name="blog[category]" id="blog_category">
					        <option selected="selected" value="1">Sport</option>
					        <option value="2">Nature</option><option value="3">Divers</option></select></div><div class="form-group"><label for="blog_description" class="control-label required">Description</label><textarea placeholder="Description" class="form-control form-control" required="required" name="blog[description]" id="blog_description"></textarea></div><div class="form-group"><label class="control-label required">Created at</label><div class="form-inline" id="blog_createdAt"><select class="form-control" name="blog[createdAt][month]" id="blog_createdAt_month"><option value="1">Jan</option><option value="2">Feb</option><option value="3">Mar</option><option value="4">Apr</option><option value="5">May</option><option value="6">Jun</option><option selected="selected" value="7">Jul</option><option value="8">Aug</option><option value="9">Sep</option><option value="10">Oct</option><option value="11">Nov</option><option value="12">Dec</option></select><select class="form-control" name="blog[createdAt][day]" id="blog_createdAt_day"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option selected="selected" value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option></select><select class="form-control" name="blog[createdAt][year]" id="blog_createdAt_year"><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option selected="selected" value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option></select></div></div></div>			      
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <button type="submit" class="btn btn-primary">Save changes</button>
			      </div>
		      </form>
		    </div>
		  </div>
		</div>
		<script>
			var dataTable = $('#blog-list').DataTable( {
		        "processing": true,
		        "serverSide": true,
			    //ajax: ''
			    "ajax":"http://workshopapi.io/app_dev.php/api/blog/list.json",
			    "columnDefs": [
			    	{
			    		"targets": 5,
			    		"data": null,
			    		"defaultContent": "<button class='btn btn-default blog-show'>Show</button> " 
			    						+ "<button class='btn btn-default blog-edit'>Edit</button>"
			    	}
			    ]
			});

			$('.blog-form').ajaxForm({ 
                dataType: 'json',
                success: function(data){
                	if (data.success) {
                		$.growl.notice({ message: data.message });
                		dataTable.ajax.reload();
                		$('#myModal').modal('hide');
                	} else {
  						$.growl.error({ message: data.message });
                	}
                }
            });

            $('#blog-list tbody').on("click", "button.blog-edit", function(){
            	var id = $(this).parents("tr:first").find('td:first').text();
            	$.getJSON("http://workshopapi.io/app_dev.php/api/blog/detail/"+id+".json").done(function(data){

            		$('.blog-form').prop("action", "http://workshopapi.io/app_dev.php/api/blog/edit/"+id+".json");
            		$('.blog-form').find('h4').text("Edit form");
            		$('#myModal').modal('show');

            		for (var prop in data) {
				        // skip loop if the property is from prototype
				        if(!data.hasOwnProperty(prop)) continue;

				        $("[name='blog[" + prop + "]']").val(data[prop]);
				    }
            	});
            });

            $('.btn-create').on('click', function(){
        		$('.blog-form').prop("action", "http://workshopapi.io/app_dev.php/api/blog/create.json");
            });

            $('#blog-list tbody').on("click", "button.blog-show", function(){
            	console.log(123);
            	var id = $(this).parents("tr:first").find('td:first').text();
        		$.getJSON("http://workshopapi.io/app_dev.php/api/blog/detail/"+id+".json")
        		.done(function(data){
        			$('#detailModal').modal('show');
        			$('#detailModal .modal-body').html("");
        			for (var prop in data) {
				        if(!data.hasOwnProperty(prop)) continue;

				        $('#detailModal .modal-body').append("<div><b>"+prop + "</b>: " + data[prop] + "</div>");
				    }
        		});
            });
		</script>
	</body>
</html>